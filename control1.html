<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Ñ‡∏™‡∏±‡πà‡∏á‡∏Å‡∏î‡∏ô‡πâ‡∏≥ & ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏ñ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }

    .app {
      width: 100%;
      max-width: 900px;
      background: #020617;
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
      border: 1px solid #1f2937;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 10px;
    }

    .title {
      font-size: 1.4rem;
      font-weight: 700;
    }

    .subtitle {
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .status-indicator {
      font-size: 0.8rem;
      padding: 6px 10px;
      border-radius: 999px;
      background: #111827;
      border: 1px solid #374151;
    }

    .status-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #f97316;
      margin-right: 6px;
    }

    .grid {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .card {
      flex: 1 1 260px;
      background: #020617;
      border-radius: 16px;
      border: 1px solid #1f2937;
      padding: 16px 16px 18px;
    }

    .card h2 {
      font-size: 1.1rem;
      margin-bottom: 4px;
    }

    .card p {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 12px;
    }

    .section-label {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    /* ‡∏õ‡∏∏‡πà‡∏° */
    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      background: #1d4ed8;
      color: white;
      margin-right: 6px;
      margin-bottom: 6px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.12s;
      box-shadow: 0 6px 14px rgba(37,99,235,0.4);
    }

    .btn.secondary {
      background: #111827;
      color: #e5e7eb;
      box-shadow: none;
      border: 1px solid #374151;
    }

    .btn.danger {
      background: #b91c1c;
      box-shadow: 0 6px 14px rgba(185,28,28,0.4);
    }

    .btn:active {
      transform: translateY(1px) scale(0.97);
      box-shadow: 0 3px 7px rgba(0,0,0,0.4);
    }

    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏ñ */
    .drive-grid {
      display: grid;
      grid-template-columns: repeat(3, 70px);
      grid-template-rows: repeat(3, 50px);
      gap: 8px;
      justify-content: center;
      margin: 10px 0 4px;
    }

    .drive-btn {
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: #111827;
      color: #e5e7eb;
      font-size: 0.9rem;
      cursor: pointer;
      transition: transform 0.08s ease, background 0.12s ease;
    }

    .drive-btn.main {
      background: #1d4ed8;
      border-color: #1d4ed8;
    }

    .drive-btn.stop {
      background: #b91c1c;
      border-color: #b91c1c;
    }

    .drive-btn:active {
      transform: translateY(1px) scale(0.97);
    }

    .center-label {
      font-size: 0.7rem;
      color: #9ca3af;
      text-align: center;
      margin-bottom: 8px;
    }

    /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
    .log-box {
      margin-top: 14px;
      font-size: 0.8rem;
      background: #020617;
      border-radius: 10px;
      border: 1px solid #111827;
      padding: 8px 10px;
      max-height: 120px;
      overflow-y: auto;
    }

    .log-line {
      margin-bottom: 4px;
      color: #9ca3af;
    }

    .log-line span.time {
      color: #6b7280;
      margin-right: 4px;
    }

    .log-line.ok {
      color: #22c55e;
    }

    .log-line.err {
      color: #f97316;
    }

    .water-options {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
    }

    .water-custom {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 4px 0 8px;
      font-size: 0.8rem;
    }

    .water-custom input {
      width: 70px;
      padding: 4px 6px;
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.8rem;
      outline: none;
    }

    .water-custom span {
      color: #9ca3af;
    }

    .footer {
      margin-top: 18px;
      font-size: 0.7rem;
      text-align: right;
      color: #6b7280;
    }

    @media (max-width: 640px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
      }

      .title {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div>
        <div class="title">‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Ñ‡∏™‡∏±‡πà‡∏á‡∏Å‡∏î‡∏ô‡πâ‡∏≥ & ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏ñ</div>
        <div class="subtitle">‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ö‡∏≠‡∏£‡πå‡∏î/‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
      </div>
      <div class="status-indicator" id="connectionStatus">
        <span class="status-dot" id="statusDot"></span>
        ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
      </div>
    </header>

    <main class="grid">
      <!-- ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏Å‡∏î‡∏ô‡πâ‡∏≥ -->
      <section class="card">
        <h2>‡∏™‡∏±‡πà‡∏á‡∏Å‡∏î‡∏ô‡πâ‡∏≥ üíß</h2>
        <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ö‡∏≠‡∏£‡πå‡∏î</p>

        <div class="section-label">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡πÅ‡∏ö‡∏ö‡∏î‡πà‡∏ß‡∏ô</div>
        <div class="water-options">
          <button class="btn" onclick="sendWaterPreset(50)">50 ml</button>
          <button class="btn" onclick="sendWaterPreset(100)">100 ml</button>
          <button class="btn" onclick="sendWaterPreset(200)">200 ml</button>
        </div>

        <div class="water-custom">
          <span>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á:</span>
          <input type="number" id="waterAmountInput" min="1" max="1000" placeholder="‡πÄ‡∏ä‡πà‡∏ô 150" />
          <span>ml</span>
          <button class="btn secondary" onclick="sendCustomWater()">‡∏™‡∏±‡πà‡∏á‡∏Å‡∏î</button>
        </div>

        <button class="btn danger" onclick="sendWaterStop()">‡∏´‡∏¢‡∏∏‡∏î‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥</button>

        <div class="log-box" id="waterLog">
          <!-- log ‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ô‡πâ‡∏≥‡∏à‡∏∞‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
        </div>
      </section>

      <!-- ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏ñ -->
      <section class="card">
        <h2>‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏ñ üöó</h2>
        <p>‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î W A S D ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á</p>

        <div class="center-label">‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á</div>
        <div class="drive-grid">
          <div></div>
          <button class="drive-btn main" onclick="sendDrive('forward')">‚ñ≤</button>
          <div></div>

          <button class="drive-btn main" onclick="sendDrive('left')">‚óÄ</button>
          <button class="drive-btn stop" onclick="sendDrive('stop')">‚ñ†</button>
          <button class="drive-btn main" onclick="sendDrive('right')">‚ñ∂</button>

          <div></div>
          <button class="drive-btn main" onclick="sendDrive('backward')">‚ñº</button>
          <div></div>
        </div>

        <div class="center-label">‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß</div>
        <div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:4px;">
          <button class="btn secondary" onclick="setSpeed(30)">‡∏ä‡πâ‡∏≤</button>
          <button class="btn secondary" onclick="setSpeed(60)">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</button>
          <button class="btn secondary" onclick="setSpeed(100)">‡πÄ‡∏£‡πá‡∏ß</button>
        </div>

        <div class="log-box" id="driveLog">
          <!-- log ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏ñ‡∏à‡∏∞‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
        </div>
      </section>
    </main>

    <footer class="footer">
      * ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÅ‡∏Å‡πâ URL API ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î JavaScript ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ö‡∏≠‡∏£‡πå‡∏î/‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    </footer>
  </div>

  <script>
    // ======= ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL API ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà =======
    // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ API ‡πÅ‡∏ö‡∏ö HTTP:
    //   POST http://192.168.4.1/api/command
    // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ URL ‡∏≠‡∏∑‡πà‡∏ô ‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    const API_URL = "http://192.168.4.1/api/command"; // <--- ‡πÅ‡∏Å‡πâ‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á

    let currentSpeed = 60; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 0-100

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
    async function sendCommand(type, payload = {}) {
      const timestamp = new Date().toLocaleTimeString();
      const body = { type, ...payload };

      // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏°‡∏µ API ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÄ‡∏ã‡∏ü HTML ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡πá‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à error
      try {
        updateStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á...", "orange");

        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });

        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json().catch(() => ({}));
        updateStatus("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "green");

        return { ok: true, data, time: timestamp };
      } catch (err) {
        updateStatus("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à / ‡πÑ‡∏°‡πà‡∏°‡∏µ API", "orange");
        return { ok: false, error: err.message, time: timestamp };
      }
    }

    function updateStatus(text, color = "orange") {
      const statusDiv = document.getElementById("connectionStatus");
      const dot = document.getElementById("statusDot");
      statusDiv.lastChild.textContent = " " + text;

      if (color === "green") {
        dot.style.background = "#22c55e";
      } else if (color === "red") {
        dot.style.background = "#b91c1c";
      } else {
        dot.style.background = "#f97316";
      }
    }

    function appendLog(elementId, message, status = "normal") {
      const box = document.getElementById(elementId);
      const div = document.createElement("div");
      div.classList.add("log-line");
      if (status === "ok") div.classList.add("ok");
      if (status === "err") div.classList.add("err");

      const timeSpan = document.createElement("span");
      timeSpan.classList.add("time");
      timeSpan.textContent = "[" + new Date().toLocaleTimeString() + "]";

      div.appendChild(timeSpan);
      div.appendChild(document.createTextNode(message));

      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    // ======= ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡πà‡∏á‡∏Å‡∏î‡∏ô‡πâ‡∏≥ =======
    async function sendWaterPreset(amountMl) {
      appendLog("waterLog", `‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏î‡∏ô‡πâ‡∏≥ ${amountMl} ml ...`);
      const result = await sendCommand("water_dispense", { amount_ml: amountMl });

      if (result.ok) {
        appendLog("waterLog", `‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏î‡∏ô‡πâ‡∏≥ ${amountMl} ml`, "ok");
      } else {
        appendLog("waterLog", `‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${result.error || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏"}`, "err");
      }
    }

    async function sendCustomWater() {
      const input = document.getElementById("waterAmountInput");
      const value = parseInt(input.value, 10);

      if (isNaN(value) || value <= 0) {
        appendLog("waterLog", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0", "err");
        return;
      }

      await sendWaterPreset(value);
    }

    async function sendWaterStop() {
      appendLog("waterLog", "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥...");
      const result = await sendCommand("water_stop");

      if (result.ok) {
        appendLog("waterLog", "‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß", "ok");
      } else {
        appendLog("waterLog", `‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${result.error || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏"}`, "err");
      }
    }

    // ======= ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏ñ =======
    function setSpeed(value) {
      currentSpeed = value;
      appendLog("driveLog", `‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß: ${value}%`, "ok");
    }

    async function sendDrive(direction) {
      appendLog("driveLog", `‡∏™‡∏±‡πà‡∏á‡∏£‡∏ñ: ${direction} (${currentSpeed}%) ...`);
      const result = await sendCommand("drive", {
        direction,
        speed: currentSpeed,
      });

      if (result.ok) {
        appendLog("driveLog", `‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${direction}`, "ok");
      } else {
        appendLog("driveLog", `‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${result.error || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏"}`, "err");
      }
    }

    // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° W A S D ‡πÅ‡∏•‡∏∞ Space
    window.addEventListener("keydown", function (e) {
      const key = e.key.toLowerCase();
      if (["w", "a", "s", "d", " "].includes(key)) {
        e.preventDefault();
      }

      switch (key) {
        case "w":
          sendDrive("forward");
          break;
        case "s":
          sendDrive("backward");
          break;
        case "a":
          sendDrive("left");
          break;
        case "d":
          sendDrive("right");
          break;
        case " ":
          sendDrive("stop");
          break;
      }
    });
  </script>
</body>
</html>
